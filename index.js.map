{"version":3,"file":"index.js","sources":["src/tracer.js","src/checkers/isAction.js","src/selectors/index.js","src/url-pattern/utils.js","src/url-pattern/addPathParams.js","src/url-pattern/addQueryParams.js","src/mappers/mapToFetch.js","src/roadhog.js"],"sourcesContent":["/*\n           ``\n            ```\n              `-`\n               `/+.\n                 .so.\n                  `yds:`\n                   .mNmds:.\n                    yNNNNmdho:.\n                    +NNNNNNNNmdho:.`\n                    :mNNNNNNNNNNNNmhs/-`\n`.                   +mNNNNNNNNNNNNNNNmhs:`\n `:.                 `+dNNNNNNNNNNNNNNNNNNds:.\n   -+:.               ./sdmNNNNNNNNNNNNNNNNNmds/.\n    `ohy+.`            `/yyhmmNNNNNNNNNNNNNNNNNNds-`\n      -hmmhso+/..`       -hddddmNNNNNNNNNNNNNNNNNNmy:`\n       `+mNNNNNNmdys+:..```/hmNNNNNNNNNNNNNNNNNNNNNNNh+. -`\n         -hmNNNNNNNNNNNmdhso/sdNNNNNNNNNNNNNNNNNNNNNNNNms+y`\n          `+mNNNNNNNNNNNNNNNNNmmNNNNNNNNNNNNNNNNNNNNNNNNNmmy`\n            .smNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNo\n              :hmNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNm:\n ..`            /hmmNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNd`\n  -odhys+:-`      `/oydmNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNs\n    `+mNNNNNNmdhhhdmNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNm`\n      .yNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNs.\n        .odNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNh\n           .+hmmmNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNm-\n             `:oydmNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNm/\n                 ``:+sdNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNs\n                      `+NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNmmhsNNNd`\n                        dNNNNNNNNNNNNNNNNNNNNNNNNmdyo/-.`:NNm:\n                      .smNNNNNNNNNNNNNmmddhyyyo+/.``    `+NNh\n                    `+dNNNNNNNmddy+:-...````        `..` +Nm:\n                   .ymNNNNNmhoo++/:. `            .://// omh\n                  -hNNNmddNd.`+/////:.`  ````  `./////// smo\n                 :ddhs/-./do` /////////:-....-:////////: hs:\n                `/-.`    .o ` -+////////+/////////////+. d-`\n                         ``   `/////////-.``.-///////+: `d\n                               `:///:-.        .-:///-` `+\n                                  ``              ``\n*/\nimport { put } from 'redux-saga/effects'\n\n// Event caught by saga with template starting with 'API_'\nconst apiEvent = (name, suffix, payload) => ({ type: `API_${name}_${suffix}`, payload })\n\n/**\n * Tracer :\n * @param {string} name - use to identify the saga event.\n * @param {function} callback - the fetch to trace.\n * @return {object} response of callback.\n */\nexport default (name, callback, sendError) => function* (args) {\n  let raw\n  try {\n    // Start Event\n    yield put(apiEvent(name, 'STARTED'))\n    raw = yield callback(args)\n    // Push saga event.\n    if (!raw.ok && sendError) {\n      throw new Error(`the fetch response has an error : ${raw.status} - ${raw.statusText}`)\n    }\n  } catch (ex) {\n    // We should not be here in any way\n    // But we handle it just in case\n    yield put(apiEvent(name, 'ERROR', ex))\n  }\n  // Finish Event\n  yield put(apiEvent(name, 'END'))\n  return raw\n}\n","export default (action) => {\n  if (!/.*_.*/.test(action)) {\n    throw new Error(`Wrong format for action: '${action}'. should be '<METHOD_NAME>_<RESOURCE_NAME>' (ie: GET_USERS)`)\n  }\n}\n\n","export const getConfig = ({ config }) => config\nexport const getAPI = state => getConfig(state).api\nexport const getMocks = state => getConfig(state).mocks\nexport const getResource = name => state => getAPI(state)[name]\n\nexport const getMethod = name => methodName => (state) => {\n  const resource = getResource(name)(state)\n  if (!resource) return {}\n  return resource[methodName]\n}\n\nexport const getOptions = name => methodName => (state) => {\n  // raw data\n  const api = getAPI(state)\n  const resource = getResource(name)(state)\n  const method = getMethod(name)(methodName)(state)\n\n  // order is general -> specific\n  let options = { method: methodName, ...api.options }\n  if (resource.options) options = { ...options, ...resource.options }\n  if (method.options) options = { ...options, ...method.options }\n\n  return options\n}\n\nexport const getURL = name => methodName => (state) => {\n  // raw data\n  const resource = getResource(name)(state)\n  const method = getMethod(name)(methodName)(state)\n\n  if (method === undefined) return resource // example: { TODOS: '/api/todos' }\n  if (typeof method === 'string') return method // example : { TODOS: { GET: '/api/todos' } }\n  return method.url // example: { TODOS: { GET: { url: '/api/todos' } } }\n}\n\nexport const getFallback = url => methodName => (state) => {\n  const mocks = getMocks(state)\n  if (!mocks) return undefined\n\n  const mock = mocks.find((m) => {\n    // url matches\n    if (m.match.test(url)) {\n      return m.method === undefined || m.method === methodName\n    }\n\n    return false // url doesn't match\n  })\n\n  return mock.fallback\n}\n","export const encodeParams = (params) => {\n  let toEncode = params\n  if (!Array.isArray(params)) toEncode = [params]\n\n  return toEncode.map(param => encodeURIComponent(param))\n}\n\nexport const isEmpty = (o) => {\n  return !o ||\n    ((typeof o === 'object' && Object.keys(o).length === 0) ||\n    (Array.isArray(o) && o.length === 0))\n}\n","import { encodeParams, isEmpty } from './utils'\n\nexport default url => (pathParams) => {\n  if (isEmpty(pathParams)) return url\n  return `${url}/${encodeParams(pathParams).join('/')}`\n}\n","import { encodeParams, isEmpty } from './utils'\n\nexport default url => (queryParams) => {\n  if (isEmpty(queryParams)) return url\n\n  const params = Object.keys(queryParams)\n    .map((k => `${k}=${encodeParams(queryParams[k])}`))\n\n  const slash = (url.endsWith('/') || url.endsWith('&') || url.endsWith('?')) ? '' : '/'\n  const questionMark = (url.endsWith('&') || url.endsWith('?')) ? '' : '?'\n\n  return `${url}${slash}${questionMark}${params.join('&')}`\n}\n","import { select } from 'redux-saga/effects'\nimport { getOptions, getURL } from '../selectors'\nimport { addPathParams, addQueryParams } from '../url-pattern'\n\nexport default action => function* (inputs) {\n  // action pattern is `<METHOD_NAME>_<RESOURCE_NAME>`\n  const [methodName, name] = action.split(/_(.+)/)\n\n  // create a fetch options object\n  let options = yield select(getOptions(name)(methodName))\n  options = { ...options, body: inputs.body }\n\n  // create a fetch url\n  let url = yield select(getURL(name)(methodName))\n  url = addPathParams(url)(inputs.path)\n  url = addQueryParams(url)(inputs.query)\n\n  return [url, options]\n}\n","import { select } from 'redux-saga/effects'\nimport tracer from './tracer'\nimport { isAction } from './checkers'\nimport { mapToFetch } from './mappers'\nimport { getFallback } from './selectors'\n\n/**\n * Library that is connected to redux, use to fetch api, and to dispatch saga event\n * @param {string} action -\n *   the template of action is like this '<METHOD_NAME>_<RESOURCE_NAME>' => GET_USERS\n * @param {object} inputs -\n *   object contains body, query and path params => {body, query: {id: 1}, path: [user, 132]}\n * @return {object} - api response or fallback define on redux.\n */\nexport default action => function* (inputs) {\n  // check action pattern and eventually throw errors\n  isAction(action)\n\n  // get fetch options to make a fetch callback\n  const [url, options] = yield mapToFetch(action)(inputs)\n\n  // get the fallback (5XX errors)\n  const fallback = yield select(getFallback(url)(options.method))\n\n  // get the raw response, from tracer or from fetch\n  const raw = yield tracer(action, () => fetch(url, options), !fallback)()\n\n  // return json response or fallback\n  return yield raw.ok ? raw.json() : fallback\n}\n"],"names":["apiEvent","name","suffix","payload","type","callback","sendError","args","put","ok","Error","raw","status","statusText","action","test","getConfig","config","getAPI","state","api","getMocks","mocks","getResource","getMethod","resource","methodName","getOptions","method","options","getURL","undefined","url","getFallback","find","m","match","fallback","encodeParams","params","toEncode","Array","isArray","map","encodeURIComponent","param","isEmpty","o","Object","keys","length","pathParams","join","queryParams","k","slash","endsWith","questionMark","inputs","split","select","body","addPathParams","path","addQueryParams","query","mapToFetch","tracer","fetch","json"],"mappings":"mQA4CA,IAAMA,EAAW,SAACC,EAAMC,EAAQC,UAAeC,YAAaH,MAAQC,EAAUC,uBAQ9DF,EAAMI,EAAUC,kCAAc,WAAWC,0HAI/CC,MAAIR,EAASC,EAAM,mCACbI,EAASE,wBAEZE,KAAMH,wBACP,IAAII,2CAA2CC,EAAIC,aAAYD,EAAIE,sFAKrEL,MAAIR,EAASC,EAAM,wCAGrBO,MAAIR,EAASC,EAAM,yCAClBU,sECrEOG,OACT,QAAQC,KAAKD,SACV,IAAIJ,mCAAmCI,y1BCFpCE,EAAY,qBAAGC,QACfC,EAAS,mBAASF,EAAUG,GAAOC,KACnCC,EAAW,mBAASL,EAAUG,GAAOG,OACrCC,EAAc,mBAAQ,mBAASL,EAAOC,GAAOlB,KAE7CuB,EAAY,mBAAQ,mBAAc,SAACL,OACxCM,EAAWF,EAAYtB,GAAMkB,UAC9BM,EACEA,EAASC,SAGLC,EAAa,mBAAQ,mBAAc,SAACR,OAEzCC,EAAMF,EAAOC,GACbM,EAAWF,EAAYtB,GAAMkB,GAC7BS,EAASJ,EAAUvB,GAAMyB,GAAYP,GAGvCU,KAAYD,OAAQF,GAAeN,EAAIS,gBACvCJ,EAASI,UAASA,OAAeA,EAAYJ,EAASI,UACtDD,EAAOC,UAASA,OAAeA,EAAYD,EAAOC,UAE/CA,KAGIC,EAAS,mBAAQ,mBAAc,SAACX,OAErCM,EAAWF,EAAYtB,GAAMkB,GAC7BS,EAASJ,EAAUvB,GAAMyB,GAAYP,eAE5BY,IAAXH,EAA6BH,EACX,iBAAXG,EAA4BA,EAChCA,EAAOI,OAGHC,EAAc,mBAAO,mBAAc,SAACd,OACzCG,EAAQD,EAASF,MAClBG,SAEQA,EAAMY,KAAK,SAACC,WAEnBA,EAAEC,MAAMrB,KAAKiB,UACKD,IAAbI,EAAEP,QAAwBO,EAAEP,SAAWF,KAMtCW,YChDDC,EAAe,SAACC,OACvBC,EAAWD,SACVE,MAAMC,QAAQH,KAASC,GAAYD,IAEjCC,EAASG,IAAI,mBAASC,mBAAmBC,MAGrCC,EAAU,SAACC,UACdA,GACS,qBAANA,gBAAAA,KAA4C,IAA1BC,OAAOC,KAAKF,GAAGG,QACzCT,MAAMC,QAAQK,IAAmB,IAAbA,EAAEG,6BCRL,SAACC,UACjBL,EAAQK,GAAoBnB,EACtBA,MAAOM,EAAaa,GAAYC,KAAK,4BCF3B,SAACC,MACjBP,EAAQO,GAAc,OAAOrB,MAE3BO,EAASS,OAAOC,KAAKI,GACxBV,IAAK,mBAAQW,MAAKhB,EAAae,EAAYC,MAExCC,EAASvB,EAAIwB,SAAS,MAAQxB,EAAIwB,SAAS,MAAQxB,EAAIwB,SAAS,KAAQ,GAAK,IAC7EC,EAAgBzB,EAAIwB,SAAS,MAAQxB,EAAIwB,SAAS,KAAQ,GAAK,aAE3DxB,EAAMuB,EAAQE,EAAelB,EAAOa,KAAK,oDCP5B,WAAWM,2GAEP5C,EAAO6C,MAAM,kBAAjCjC,OAAYzB,gBAGC2D,SAAOjC,EAAW1B,GAAMyB,kCAC7BG,GAASgC,KAAMH,EAAOG,gBAGrBD,SAAO9B,EAAO7B,GAAMyB,6BAC9BoC,EAAc9B,GAAK0B,EAAOK,QAC1BC,EAAehC,GAAK0B,EAAOO,0BAEzBjC,EAAKH,qGCHU,WAAW6B,2GAEzB5C,YAGoBoD,EAAWpD,GAAQ4C,0DAGzBE,SAAO3B,EAAYD,GAAKH,EAAQD,0CAGrCuC,EAAOrD,EAAQ,kBAAMsD,MAAMpC,EAAKH,KAAWQ,uCAGhD1B,EAAIF,GAAKE,EAAI0D,OAAShC"}